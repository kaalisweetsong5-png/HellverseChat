# Nixpacks configuration for Railway
[phases.setup]
nixPkgs = ['nodejs', 'npm']

[phases.install]
cmds = [
  'echo "=== Install Phase Debug Info ==="',
  'echo "Current directory: $(pwd)"',
  'echo "Directory contents:"',
  'ls -la',
  'echo "=== Installing backend dependencies ==="',
  'if [ -d "backend" ] && [ -f "backend/package.json" ]; then echo "Installing backend dependencies..." && npm install --prefix backend; else echo "Backend directory or package.json not found"; fi',
  'echo "=== Installing frontend dependencies ==="',
  'if [ -d "frontend" ] && [ -f "frontend/package.json" ]; then echo "Installing frontend dependencies..." && npm install --prefix frontend; else echo "Frontend directory or package.json not found"; fi',
  'echo "=== Installing root dependencies ==="',
  'if [ -f "package.json" ]; then echo "Installing root dependencies..." && npm install; else echo "No root package.json found"; fi',
  'echo "=== Install phase complete ==="'
]

[phases.build]
cmds = [
  'echo "=== Build Phase Debug Info ==="',
  'echo "Current directory: $(pwd)"',
  'echo "Directory contents:"',
  'ls -la',
  'echo "=== Checking directories ==="',
  'echo "Frontend directory check:"',
  'ls -la frontend 2>/dev/null || echo "Frontend directory not accessible"',
  'echo "Backend directory check:"',
  'ls -la backend 2>/dev/null || echo "Backend directory not accessible"',
  'echo "=== Package.json files ==="',
  'echo "Root package.json:" && ls -la package.json 2>/dev/null || echo "No root package.json"',
  'echo "Frontend package.json:" && ls -la frontend/package.json 2>/dev/null || echo "No frontend package.json"',
  'echo "Backend package.json:" && ls -la backend/package.json 2>/dev/null || echo "No backend package.json"',
  'echo "=== Building frontend ==="',
  'if [ -d "frontend" ] && [ -f "frontend/package.json" ]; then echo "Building frontend..." && cd frontend && npm run build; else echo "Skipping frontend build - directory or package.json not found"; fi',
  'echo "=== Build phase complete ==="'
]

[start]
cmd = 'npm run start:production'

[variables]
NODE_ENV = 'production'